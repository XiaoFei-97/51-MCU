C51 COMPILER V9.00   MAIN                                                                  11/03/2017 20:06:21 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /**************************************************************************************
   2          *                             EEPROM-IIC实验                                                                                              *
   3          实现现象：下载程序后数码管后4位显示0，按K1保存显示的数据，按K2读取上次保存的数据，
   4                            按K3显示数据加一，按K4显示数据清零。最大能写入的数据是255.
   5          注意事项：由于P3.2口跟红外线共用，所以做按键实验时为了不让红外线影响实验效果，最好把红外线先取下来。                                            
             -                                                                                                                  
   6          ***************************************************************************************/
   7          
   8          #include "reg52.h"                       //此文件中定义了单片机的一些特殊功能寄存器
   9          #include "i2c.h"        
  10          
  11          typedef unsigned int u16;         //对数据类型进行声明定义
  12          typedef unsigned char u8;
  13          
  14          sbit LSA=P2^2;
  15          sbit LSB=P2^3;
  16          sbit LSC=P2^4;
  17          
  18          sbit k1=P3^1;
  19          sbit k2=P3^0;
  20          sbit k3=P3^2;
  21          sbit k4=P3^3;    //定义按键端口
  22          
  23          char num=0;
  24          u8 disp[4];
  25          u8 code smgduan[10]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f};
  26          
  27          /*******************************************************************************
  28          * 函 数 名         : delay
  29          * 函数功能                 : 延时函数，i=1时，大约延时10us
  30          *******************************************************************************/
  31          void delay(u16 i)
  32          {
  33   1              while(i--);     
  34   1      }
  35          
  36          
  37          /*******************************************************************************
  38          * 函数名         :Keypros()
  39          * 函数功能               :按键处理函数
  40          * 输入           : 无
  41          * 输出           : 无
  42          *******************************************************************************/
  43          void Keypros()
  44          {
  45   1              if(k1==0)
  46   1              {
  47   2                      delay(1000);  //消抖处理
  48   2                      if(k1==0)
  49   2                      {
  50   3                              At24c02Write(1,num);   //在地址1内写入数据num
  51   3                      }
  52   2                      while(!k1);
  53   2              }
  54   1              if(k2==0)
C51 COMPILER V9.00   MAIN                                                                  11/03/2017 20:06:21 PAGE 2   

  55   1              {
  56   2                      delay(1000);  //消抖处理
  57   2                      if(k2==0)
  58   2                      {
  59   3                              num=At24c02Read(1);       //读取EEPROM地址1内的数据保存在num中
  60   3                      }
  61   2                      while(!k2);
  62   2              }
  63   1              if(k3==0)
  64   1              {
  65   2                      delay(100);  //消抖处理
  66   2                      if(k3==0)
  67   2                      {
  68   3                              num++;     //数据加1
  69   3                              if(num>255)num=0;
  70   3                      }
  71   2                      while(!k3);
  72   2              }
  73   1              if(k4==0)
  74   1              {
  75   2                      delay(1000);  //消抖处理
  76   2                      if(k4==0)
  77   2                      {
  78   3                              num=0;           //数据清零
  79   3                      }
  80   2                      while(!k4);
  81   2              }               
  82   1      }
  83          
  84          /*******************************************************************************
  85          * 函数名         :datapros()
  86          * 函数功能               :数据处理函数
  87          * 输入           : 无
  88          * 输出           : 无
  89          *******************************************************************************/
  90          void datapros()
  91          {
  92   1              disp[0]=smgduan[num/1000];//千位
  93   1              disp[1]=smgduan[num%1000/100];//百位
  94   1              disp[2]=smgduan[num%1000%100/10];//个位
  95   1              disp[3]=smgduan[num%1000%100%10];               
  96   1      }
  97          
  98          
  99          /*******************************************************************************
 100          * 函数名         :DigDisplay()
 101          * 函数功能               :数码管显示函数
 102          * 输入           : 无
 103          * 输出           : 无
 104          *******************************************************************************/
 105          void DigDisplay()
 106          {
 107   1              u8 i;
 108   1              for(i=0;i<4;i++)
 109   1              {
 110   2                      switch(i)        //位选，选择点亮的数码管，
 111   2                      {
 112   3                              case(0):
 113   3                                      LSA=0;LSB=0;LSC=0; break;//显示第0位
 114   3                              case(1):
 115   3                                      LSA=1;LSB=0;LSC=0; break;//显示第1位
 116   3                              case(2):
C51 COMPILER V9.00   MAIN                                                                  11/03/2017 20:06:21 PAGE 3   

 117   3                                      LSA=0;LSB=1;LSC=0; break;//显示第2位
 118   3                              case(3):
 119   3                                      LSA=1;LSB=1;LSC=0; break;//显示第3位    
 120   3                      }
 121   2                      P0=disp[3-i];//发送数据
 122   2                      delay(100); //间隔一段时间扫描  
 123   2                      P0=0x00;//消隐
 124   2              }               
 125   1      }
 126          
 127          /*******************************************************************************
 128          * 函 数 名       : main
 129          * 函数功能               : 主函数
 130          * 输    入       : 无
 131          * 输    出       : 无
 132          *******************************************************************************/
 133          void main()
 134          {       
 135   1              while(1)
 136   1              {
 137   2                      Keypros();       //按键处理函数
 138   2                      datapros();      //数据处理函数
 139   2                      DigDisplay();//数码管显示函数           
 140   2              }               
 141   1      }
 142          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    319    ----
   CONSTANT SIZE    =     10    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
